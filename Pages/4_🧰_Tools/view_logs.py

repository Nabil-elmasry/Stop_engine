# Pages/4_ğŸ§°_Tools/view_logs.py

import streamlit as st
import os
import base64
from datetime import datetime

st.set_page_config(page_title="ğŸ“„ Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡", layout="wide")
st.title("ğŸ“„ Ø¹Ø±Ø¶ ÙˆØªØµØ¯ÙŠØ± Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«")

log_path = "log/app_log.txt"

# Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù
if not os.path.exists(log_path):
    st.warning("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ù‹Ø§.")
else:
    # Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù
    with open(log_path, "r", encoding="utf-8") as f:
        log_content = f.read()

    st.text_area("ğŸ“œ Ù…Ø­ØªÙˆÙ‰ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:", log_content, height=400)

    # ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ PDF Ø¨Ø³ÙŠØ· (Ù†Øµ ÙÙ‚Ø·)
    if st.button("â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ ÙƒÙ…Ù„Ù PDF"):
        from fpdf import FPDF

        pdf = FPDF()
        pdf.add_page()
        pdf.set_font("Arial", size=10)

        for line in log_content.split("\n"):
            pdf.cell(200, 5, txt=line, ln=1)

        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        pdf_filename = f"log_report_{timestamp}.pdf"
        pdf.output(pdf_filename)

        with open(pdf_filename, "rb") as f:
            base64_pdf = base64.b64encode(f.read()).decode('utf-8')
            pdf_href = f'<a href="data:application/pdf;base64,{base64_pdf}" download="{pdf_filename}">ğŸ“¥ Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ØµÙŠØºØ© PDF</a>'
            st.markdown(pdf_href, unsafe_allow_html=True)

        os.remove(pdf_filename)
