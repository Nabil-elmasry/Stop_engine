import streamlit as st
import pdfplumber
import pandas as pd
import base64
import io

st.set_page_config(page_title="ğŸ“„ ØªØ­ÙˆÙŠÙ„ PDF Ø¥Ù„Ù‰ CSV", layout="wide")
st.title("ğŸ“„ğŸ”„ ØªØ­ÙˆÙŠÙ„ ØªÙ‚Ø±ÙŠØ± PDF Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ CSV")

# âœ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
uploaded_pdf = st.file_uploader("ğŸ“¤ Ø§Ø±ÙØ¹ Ù…Ù„Ù PDF ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³Ø§Øª Ø£Ùˆ ØªÙ‚Ø±ÙŠØ±", type=["pdf"])

# âœ… Ø²Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„
if uploaded_pdf and st.button("ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ CSV"):
    try:
        with pdfplumber.open(uploaded_pdf) as pdf:
            data = []
            for page in pdf.pages:
                table = page.extract_table()
                if table:
                    data.extend(table)

        # ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ DataFrame
        df = pd.DataFrame(data[1:], columns=data[0])  # Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø±Ø¤ÙˆØ³ Ø£Ø¹Ù…Ø¯Ø©
        st.success("âœ… ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„Ù‡ Ø§Ù„Ø¢Ù†.")
        st.dataframe(df)

        # Ø­ÙØ¸ Ù…Ø¤Ù‚Øª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (ÙˆÙ„ÙŠØ³ ÙƒÙ…Ù„Ù Ø­Ù‚ÙŠÙ‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±)
        csv_buffer = io.StringIO()
        df.to_csv(csv_buffer, index=False)
        csv_bytes = csv_buffer.getvalue().encode()
        b64 = base64.b64encode(csv_bytes).decode()
        href = f'<a href="data:file/csv;base64,{b64}" download="converted_data.csv">ğŸ“¥ Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù CSV</a>'
        st.markdown(href, unsafe_allow_html=True)

    except Exception as e:
        st.error(f"âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„: {e}")

else:
    st.info("â¬†ï¸ Ø¨Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„.")